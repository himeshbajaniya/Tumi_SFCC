!function(e){var t={};function s(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2)}([function(e,t,s){"use strict";e.exports=function(e,t){var s=$(".js-notification-message");if(e){var a=$(".js-"+e+"-message");s.removeClass("js-d-flex"),$(a).addClass("js-d-flex"),t&&(s.find(".js-body-"+e+"-message").text(""),$(a).find(".js-body-"+e+"-message").text(t)),$("body,html").animate({scrollTop:0},250)}else s.removeClass("js-d-flex"),s.find(".js-body-"+e+"-message").text("")}},,function(e,t,s){"use strict";var a=s(0),n=s(3);function r(e){return"SFCC_"+e.replace(/[-\s]+/g,"_").replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase()}function o(e,t){var s=$(".js-page-data-block .js-"+e+"-events .js-emarsys-name-select").clone();if(null!=t){var a=s.find('[value="'+t+'"]');s.prepend(a),a.prop("selected",!0)}return s}function i(){var e=$(".js-notification-messages").data("server-error");a("error",e),setTimeout((function(){a()}),5e3)}function c(e,t){$(".js-page-data-block .js-"+t+"-events .js-emarsys-name-select").children('[value="'+e.emarsysName+'"]').attr("data-emarsys-id",e.emarsysId),$(".js-"+t+"-events-table .js-emarsys-name-select").filter(":not(:disabled)").each((function(){var e=$(this).children(":first").attr("value"),s=o(t,e),a=$(".js-emarsys-select-data").data("option-cancel-title");s.children(":first").text(a),s.val($(this).val()),$(this).replaceWith(s)}))}function l(e,t){var s=$(".js-page-data-block .js-"+t+"-events").data("emarsys-descriptions"),a={event:e,index:s.length};s.some((function(e,t){var s=e.emarsysName===this.event.emarsysName;return s&&(this.index=t),s}),a),s.splice(a.index,1,e)}e.exports={processEmptyTableNotifications:function(){function e(e){0===$(".js-"+e+"-events-table .js-external-events-row").length&&$(".js-"+e+"-events-table .js-empty-table-notification").removeClass("hide-content")}e("subscription"),e("other")},initAddEventDialog:function(){n.init({dialogSelector:".js-page-data-block .js-add-event-dialog",openCallback:function(){var e=this.dialog,t=$(".js-"+this.eventType+"-events .js-sfcc-name-select").clone(),s=e.find(".js-sfcc-name-select");s.children(":first").insertBefore(t.children(":first")),t.children(":first").prop("selected",!0),s.replaceWith(t);var a=e.find(".js-emarsys-name-select");if("subscription"===this.eventType){var r=o(this.eventType);r.prepend(a.children(":first")),r.children('[value=""]').remove(),r.children(":first").prop("selected",!0),a.replaceWith(r)}else e.find(".js-emarsys-name-select").addClass("hide-content");n.applyReplacementsList(e,this.replaceList),n.open(e)},closeCallback:function(){var e=this.dialog;n.close(e),a();var t=e.find(".js-emarsys-name-select option").filter(":selected"),s=e.find(".js-sfcc-name-select option").filter(":selected");return{eventType:this.eventType,event:{emarsysId:t.attr("data-emarsys-id"),emarsysName:t.attr("value"),sfccName:s.attr("value")}}}})},initAddEventButtons:function(){function e(e){var t=!0;if(0===$(".js-page-data-block .js-"+e+"-events .js-sfcc-name-select").find("option[value]").length){var s=$(".js-notification-messages").data("empty-source-error");a("error",s),setTimeout((function(){a()}),1e4),t=!1}return t}function t(e){var t=$(e),s={newRow:t.find(".js-external-events-row"),requestBodyExample:t.find(".js-supported-events-data").data("request-example"),triggerForm:t.find(".js-trigger-form"),error:t.find(".js-request-error").data("error")};if(s.newRow){var n,r={emarsysId:s.newRow.attr("data-emarsys-id"),emarsysName:s.newRow.attr("data-emarsys-name"),sfccName:s.newRow.attr("data-sfcc-name"),campaignId:s.newRow.find(".js-campaign-status").attr("data-id"),campaignStatus:s.newRow.find(".js-campaign-status").attr("data-status")},o=this.eventType,i=$(".js-page-data-block .js-"+o+"-events").data("campaigns");if(i[r.emarsysId]?i[r.emarsysId].status=r.campaignStatus:i[r.emarsysId]={id:r.campaignId,status:r.campaignStatus},"new"===r.emarsysStatus&&"other"!==o&&c(r,o),$(".js-page-data-block .js-"+o+"-events .js-sfcc-name-select").children('[value="'+r.sfccName+'"]').remove(),$(".js-"+o+"-events-table .js-empty-table-notification").addClass("hide-content"),s.newRow.insertBefore($(".js-"+o+"-events-table .js-empty-table-notification")),s.requestBodyExample&&s.requestBodyExample.length)$(".js-page-data-block .js-"+o+"-events").data("request-examples")[r.emarsysName]=s.requestBodyExample;s.triggerForm&&s.triggerForm.length&&$(".js-page-data-block .js-"+o+"-forms").append(s.triggerForm),l(r,o);var d=$(".js-notification-messages");n=d.data("success-event")+r.sfccName+d.data("success-created"),a("success",n)}else s.error&&"ERROR"===s.error.message&&a("error",s.error.message)}function s(e){if(e&&"cancel"!==e.status){var s="",n=e.data.eventType,o=e.data.event;if(!o.sfccName)return s=$(".js-notification-messages").data("empty-name-error"),a("error",s),void setTimeout((function(){a()}),5e3);if("appropriate"===o.emarsysName){o.emarsysName=r(o.sfccName);var c=$(".js-page-data-block .js-"+n+"-events .js-emarsys-name-select").children('[value="'+o.emarsysName+'"]');o.emarsysId=c.attr("data-emarsys-id")}var l=$(".js-page-data-block .js-"+n+"-events").data("campaigns")[o.emarsysId],d={type:n,sfccName:o.sfccName,emarsysId:o.emarsysId,emarsysName:o.emarsysName,campaignId:l&&l.id,campaignStatus:l&&l.status};$.ajax({url:$(".js-page-links").data("urls").addEvent,type:"post",dataType:"text",data:d,context:{eventType:n},success:t,error:i})}}$(".js-add-subscription-event-button").on("click",{dialogPopup:n,userResponseHandler:s,checkSfccNameOptions:e},(function(e){var t=e.data;t.checkSfccNameOptions("subscription")&&n.getUserResponse({dialogSelector:".js-add-event-dialog",eventType:"subscription",replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("add-subscription")}]}).then(t.userResponseHandler)})),$(".js-add-other-event-button").on("click",{dialogPopup:n,userResponseHandler:s,checkSfccNameOptions:e},(function(e){var t=e.data;t.checkSfccNameOptions("other")&&n.getUserResponse({dialogSelector:".js-add-event-dialog",eventType:"other",replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("add-other")}]}).then(t.userResponseHandler)}))},initChangeButtons:function(){function e(e,t){var s=$(".js-button-labels").data("apply");t.text(s),t.removeClass("js-change-button"),t.addClass("js-apply-changes-button");var n=t.closest(".js-external-events-row"),i=n.find(".js-emarsys-name-select"),c=o(e,i.children(":selected").attr("value"));if("other"===e){var l=r(n.attr("data-sfcc-name"));c.children(':not([value="'+l+'"],[value=""])').remove()}var d=$(".js-emarsys-select-data").data("option-cancel-title");c.children(":first").text(d),i.replaceWith(c),a()}$(".js-subscription-events-table").on("click",".js-change-button",{changeEvent:e},(function(e){e.data.changeEvent("subscription",$(e.target))})),$(".js-other-events-table").on("click",".js-change-button",{changeEvent:e},(function(e){e.data.changeEvent("other",$(e.target))}))},initApplyButton:function(){function e(){var e=$(".js-button-labels").data("change");this.updateButton.text(e),this.updateButton.removeClass("js-apply-changes-button"),this.updateButton.addClass("js-change-button");var t=this.row.find(".js-emarsys-name-select"),s=t.children(":first"),a=$(".js-page-data-block .js-"+this.eventType+"-events .js-emarsys-name-select").children('option[value="'+this.prevEmarsysName+'"]').clone(),n=t.children(":selected").attr("value");s.replaceWith(a),t.val(n),t.prop("disabled",!0),this.updateButton.prop("disabled",!1)}function t(e){if(e.response&&"OK"===e.response.status){var t,s=e.response.result.event,n=e.response.result.campaigns;if("new"===s.emarsysStatus&&"subscription"===this.eventType&&c(s,this.eventType),this.row.find(".js-emarsys-name-select").children('[value="'+s.emarsysName+'"]').prop("selected",!0),this.row.attr("data-emarsys-id",s.emarsysId),this.row.attr("data-emarsys-name",s.emarsysName),l(s,this.eventType),n){var r=$(".js-page-data-block .js-"+this.eventType+"-events").data("campaigns");r[s.emarsysId]?r[s.emarsysId].status=n[s.emarsysId].status:r[s.emarsysId]={id:n[s.emarsysId].id,status:n[s.emarsysId].status};var o=this.row.find(".js-campaign-status");o.attr("data-id",n[s.emarsysId].id),o.attr("data-status",n[s.emarsysId].status),o.text(n[s.emarsysId].status)}var i=$(".js-notification-messages");t=i.data("success-event")+s.sfccName+i.data("success-changed"),a("success",t)}else e.response&&"ERROR"===e.response.status&&a("error",e.response.message)}function s(s,a){var n=a.closest(".js-external-events-row"),r=n.find(".js-emarsys-name-select").find("option").filter(":selected"),o=r.attr("value"),c=r.attr("data-emarsys-id"),l=n.attr("data-emarsys-name"),d={eventType:s,row:n,updateButton:a,prevEmarsysName:l};if(o!==l){var u=$(".js-page-data-block .js-"+s+"-events").data("campaigns"),p={type:s,sfccName:n.attr("data-sfcc-name"),emarsysId:c,emarsysName:o};c&&u[c]&&(p.campaignId=u[c].id,p.campaignStatus=u[c].status),a.prop("disabled",!0),$.ajax({url:$(".js-page-links").data("urls").updateEvent,type:"post",dataType:"json",data:p,context:d,success:t,error:i,complete:e})}else e.call(d)}$(".js-subscription-events-table").on("click",".js-apply-changes-button",{applyChanges:s},(function(e){e.data.applyChanges("subscription",$(e.target))})),$(".js-other-events-table").on("click",".js-apply-changes-button",{applyChanges:s},(function(e){e.data.applyChanges("other",$(e.target))}))},initRequestBodyExampleDialog:function(){n.init({dialogSelector:".js-page-data-block .js-request-body-example",openCallback:function(){var e=this.dialog,t=$(".js-page-data-block .js-"+this.eventType+"-events").data("request-examples")[this.emarsysEventName],s="";s=t?JSON.stringify(t,null,2):$(".js-page-data-block .js-dialog-messages").data("unsupported-event"),e.find(".js-content-block pre").text(s),n.applyReplacementsList(e,this.replaceList),n.open(e)}})},initRequestBodyExampleButton:function(){function e(e,t){var s=t.closest(".js-external-events-row"),r=s.attr("data-sfcc-name"),o=s.attr("data-emarsys-name");n.getUserResponse({dialogSelector:".js-request-body-example",eventType:e,emarsysEventName:o,replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("show-example")+' "'+r+'"'}]}),a()}$(".js-subscription-events-table").on("click",".js-example-button",{showRequestBodyExample:e},(function(e){e.data.showRequestBodyExample("subscription",$(e.target))})),$(".js-other-events-table").on("click",".js-example-button",{showRequestBodyExample:e},(function(e){e.data.showRequestBodyExample("other",$(e.target))}))},initTriggerEventDialog:function(){n.init({dialogSelector:".js-page-data-block .js-trigger-event",openCallback:function(){var e=this.dialog,t=e.find(".js-content-block");t.find(".js-trigger-form").attr("data-event-name")!==this.event.sfccName&&(t.children().remove(),t.append(this.formTemplate)),n.applyReplacementsList(e,this.replaceList),n.open(e)},closeCallback:function(){var e=this.dialog;n.close(e),a();var t,s,r,o=e.find(".js-content-block .js-trigger-form"),i=e.find(".js-content-block .js-input-fields"),c={};return Array.prototype.forEach.call(i,(function(e){this.formData[$(e).attr("name")]=$(e).val()}),{formData:c}),{eventType:this.eventType,formData:c,isValid:(t=o,s=t.find(".js-input-fields"),r={isValid:!0},Array.prototype.forEach.call(s,(function(e){var t="required"===$(e).attr("required"),s=""===$(e).val();t&&s&&(this.isValid=!1)}),r),r.isValid),event:this.event}}})},initTriggerEventButton:function(){function e(e){e.response&&"OK"===e.response.status?a("success","The event was successfully triggered"):e.response&&"ERROR"===e.response.status&&a("error",e.response.message)}function t(t){if(t&&"cancel"!==t.status){var s=t.data.eventType,n=t.data.formData,r=t.data.isValid,o=t.data.event;if(!r){var c=$(".js-notification-messages").data("form-validation-error");return a("error",c),void setTimeout((function(){a()}),5e3)}var l={type:s,sfccName:o.sfccName,emarsysId:o.emarsysId,emarsysName:o.emarsysName,formData:JSON.stringify(n)};$.ajax({url:$(".js-page-links").data("urls").triggerEvent,type:"post",dataType:"json",data:l,context:{eventType:s},success:e,error:i})}}function s(e,s){var r=s.closest(".js-external-events-row"),o={emarsysId:r.attr("data-emarsys-id"),emarsysName:r.attr("data-emarsys-name"),sfccName:r.attr("data-sfcc-name")},i="";if(!o.emarsysId)return i=$(".js-notification-messages").data("invalid-mapping")+' "'+o.sfccName+'"',a("error",i),void setTimeout((function(){a()}),5e3);var c=$(".js-page-data-block .js-"+e+"-forms").find('[data-event-name="'+o.sfccName+'"]')[0];if(!c)return i=$(".js-notification-messages").data("no-trigger-form")+' "'+o.emarsysName+'"',a("error",i),void setTimeout((function(){a()}),5e3);n.getUserResponse({dialogSelector:".js-trigger-event",eventType:e,event:o,formTemplate:$(c).clone(),replaceList:[{selector:".js-dialog-title",text:$(".js-dialog-messages").data("trigger-event")+' "'+o.sfccName+'"'}]}).then(t),a()}$(".js-subscription-events-table").on("click",".js-trigger-button",{triggerEvent:s},(function(e){e.data.triggerEvent("subscription",$(e.target))})),$(".js-other-events-table").on("click",".js-trigger-button",{triggerEvent:s},(function(e){e.data.triggerEvent("other",$(e.target))}))},initRefreshStatusButtons:function(){function e(e){if(e.response&&"OK"===e.response.status){var t=e.response.eventType,s=e.response.campaigns;$(".js-page-data-block .js-"+t+"-events").data("campaigns",s),$(".js-"+t+"-events-table .js-external-events-row").each((function(){var e=$(this).attr("data-emarsys-id");if(e){var t=$(this).find(".js-campaign-status");t.attr("data-id",s[e].id),t.attr("data-status",s[e].status),t.text(s[e].status)}})),a("success",'Statys for "'+t+'" event campaigns was successfully refreshed')}else e.response&&"ERROR"===e.response.status&&a("error",e.response.message)}function t(t){var s=$(".js-page-data-block .js-"+t+"-events").data("emarsys-descriptions"),a={type:t,descriptions:JSON.stringify(s)};$.ajax({url:$(".js-page-links").data("urls").campaignStatus,type:"post",dataType:"json",data:a,context:{eventType:t},success:e,error:i})}$(".js-refresh-status-subscription").on("click",{refreshStatus:t},(function(e){e.data.refreshStatus("subscription",$(e.target))})),$(".js-refresh-status-other").on("click",{refreshStatus:t},(function(e){e.data.refreshStatus("other",$(e.target))}))}}},function(e,t,s){"use strict";function a(e){e.parent().removeClass("hidden-block")}function n(e){e.parent().addClass("hidden-block"),l(e)}function r(e,t){var s=null;return t.dialog?t.dialog instanceof jQuery?s=t.dialog:t.dialog instanceof HTMLElement&&(s=$(t.dialog),$.extend(t,{dialog:s})):t.dialogSelector&&(s=e.find(t.dialogSelector).first()),s}function o(e){var t=e.data,s=t.arguments,a=null;s.closeCallback?a=s.closeCallback(t):n(s.dialog),t.promiseResolve({status:t.status,data:a})}function i(e){var t=e.arguments,s=null;t.closeCallback?s=t.closeCallback(e):n(t.dialog),e.promiseResolve({status:e.status,data:s})}function c(e){var t=e.data;"Enter"===e.code?i({status:"confirm",promiseResolve:t.promiseResolve,arguments:t.arguments}):"Escape"===e.code&&i({status:"cancel",promiseResolve:t.promiseResolve,arguments:t.arguments}),e.preventDefault()}function l(e){var t=e.parent();e.off("click"),t.off("click"),$(document.body).off("keyup",c)}e.exports={init:function(e){var t=r($(document.body),e);if(!t||!t.length)return null;e.dialog||(t=t.clone(),$.extend(e,{dialog:t}));var s=$("<div>",{class:"js-dialog-wrapper dialog-wrapper hidden-block"});s.append(t),s.data(e);var a=$(".js-dialog-container").first();return a.length||(a=$("<div>",{class:"js-dialog-container dialog-container"}),$(document.body).append(a)),a.append(s),t},getUserResponse:function(e){var t=r($(".js-dialog-container").first(),e);if(!t.length)return Promise.resolve();var s=function(e,t){var s=e.parent().data(),a=Object.create(s);return $.extend(a,t),a}(t,e);return new Promise((function(e){var n={arguments:s,promiseResolve:e};s.openCallback?s.openCallback(n):a(t),function(e,t){var s=e.parent();e.on("click",".js-confirm-button",$.extend({},t,{status:"confirm"}),o),e.on("click",".js-cancel-button,.js-close-button",$.extend({},t,{status:"cancel"}),o),s.on("click",$.extend({},t,{status:"cancel"}),o),e.on("click",(function(e){e.stopPropagation()})),$(document.body).on("keyup",$.extend({},t),c)}(t,n)}))},open:a,close:n,detach:function(e){return e.parent().detach()},removeEventHandlers:l,applyReplacementsList:function(e,t){t&&t.forEach((function(e){this.find(e.selector).text(e.text)}),e)}}}]);